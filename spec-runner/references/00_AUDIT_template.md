# 审计日志模板

复制此模板到每个 change 目录的 `AUDIT.md` 文件。

```markdown
# 审计日志

## 基本信息

- **Change ID**: YYYY-MM-DD-N-name
- **创建时间**: YYYY-MM-DD HH:MM:SS
- **创建人**: admin (Claude)

## 时间线

| 步骤 | 开始时间 | 结束时间 | 耗时 | 状态 |
|------|----------|----------|------|------|
| 步骤1：创建提案 | | | | 待开始 |
| 步骤2：设计拆解 | | | | 待开始 |
| 步骤3：提案细化 | | | | 待开始 |
| 步骤4：评审提案 | | | | 待开始 |
| 步骤5：Apply施工 | | | | 待开始 |
| 步骤6：归档 | | | | 待开始 |
| 步骤7：Git提交 | | | | 待开始 |

## 决策记录索引

| 决策ID | 描述 | 关卡 | 详见 |
|--------|------|------|------|
| TBD-1 | [决策简述] | [关卡名称] | [DECISIONS.md#tbd-1](DECISIONS.md#tbd-1) |
| TBD-2 | [决策简述] | [关卡名称] | [DECISIONS.md#tbd-2](DECISIONS.md#tbd-2) |

## 文件变更索引

| 快照 | 文件 | 变更类型 | 关联步骤 | 时间 |
|------|------|----------|----------|------|
| 001 | proposal.md | 创建 | 创建提案 | |
| 002 | tasks.md | 创建 | 设计拆解 | |
| 003 | proposal.md | 修改 | 提案细化 | |

## 测试记录

### 场景覆盖概览

| 任务 | Requirement | Spec Scenarios | 测试场景 | 测试用例 | 状态 |
|------|-------------|----------------|----------|----------|------|
| 任务1 | [功能名称] | N | M | X | ✓ |
| 任务2 | [功能名称] | N | M | Y | ✓ |

### 新增测试文件

| 测试文件 | 测试用例数 | 测试场景数 | 覆盖 Scenarios | 状态 |
|----------|-----------|-----------|-----------------|------|
| tests/xxx_test.py | X | Y | N | ✓ |

### 修改测试文件

| 测试文件 | 修改说明 | 状态 |
|----------|----------|------|
| tests/yyy_test.py | 适配新功能 | ✓ |

### 测试执行汇总

| 阶段 | 测试命令 | 通过/总数 | 状态 |
|------|----------|-----------|------|
| 任务1测试 | pytest tests/xxx_test.py -v | X/X | ✓ |
| 任务2测试 | pytest tests/yyy_test.py -v | Y/Y | ✓ |
| 全量测试 | pytest | T/T | ✓ |

### 代码覆盖率

- 新增代码覆盖率: XX%
- 全量代码覆盖率: XX%
- 覆盖率变化: +X%

## 步骤详情

### 1. 创建提案

**执行时间**: YYYY-MM-DD HH:MM - HH:MM
**耗时**: Xm
**状态**: ✓ / ⚠️

**说明**:
[简要描述本步骤的执行情况]

### 2. 设计拆解

**执行时间**: YYYY-MM-DD HH:MM - HH:MM
**耗时**: Xm
**状态**: ✓ / ⚠️

**说明**:
[简要描述本步骤的执行情况]

### 3. 提案细化

**执行时间**: YYYY-MM-DD HH:MM - HH:MM
**耗时**: Xm
**状态**: ✓ / ⚠️

**说明**:
[简要描述本步骤的执行情况]

### 4. 评审提案

**执行时间**: YYYY-MM-DD HH:MM - HH:MM
**耗时**: Xm
**状态**: ✓ / ⚠️

**说明**:
[简要描述本步骤的执行情况]

### 5. Apply施工

**执行时间**: YYYY-MM-DD HH:MM - HH:MM
**耗时**: Xm
**状态**: ✓ / ⚠️

**说明**:
[简要描述本步骤的执行情况]

#### 任务测试记录

##### 任务 1：[任务名称]

**测试场景**:
- 场景1: [描述] → ✓
- 场景2: [描述] → ✓
- 场景3: [描述] → ✓

**测试文件**: tests/xxx_test.py
**测试命令**: pytest tests/xxx_test.py -v
**测试结果**: ✓ 全绿（X/X 通过）
**覆盖 Scenarios**: N/N（补充边界场景 M 个）

### 6. 归档

**执行时间**: YYYY-MM-DD HH:MM - HH:MM
**耗时**: Xm
**状态**: ✓ / ⚠️

**说明**:
[简要描述本步骤的执行情况]

#### 全量测试详情

**测试命令**: pytest / npm test
**执行时间**: YYYY-MM-DD HH:MM:SS
**测试结果**: ✓ 全绿

#### 统计
- Spec Scenarios 覆盖: N/N（100%）
- 新增测试场景: M 个（来自 Scenarios: N 个，补充边界: K 个）
- 新增测试用例: X 条
- 修改测试用例: Y 条
- 单元测试通过: X/X
- 集成测试通过: Y/Y
- 全量测试通过: T/T
- 代码覆盖率: XX%

#### 测试失败修复（如有）
- 失败1: [描述] → 修复方式: [描述]
- 失败2: [描述] → 修复方式: [描述]

### 7. Git 提交

**执行时间**: YYYY-MM-DD HH:MM - HH:MM
**耗时**: Xm
**状态**: ✓ / ⚠️

**Git Commit**:
```
Commit: [commit hash]
Message: [commit message 第一行]
```

## 遗留问题

| 问题ID | 描述 | 优先级 | 后续处理 |
|--------|------|--------|----------|
| ISSUE-1 | [问题描述] | 高/中/低 | [后续change或解决方案] |

---

## 时间获取命令（审计专用）

**审计日志中记录时间时必须使用命令获取，禁止猜测或估算。**

### 快捷命令

| 需求 | 命令 | 输出示例 |
|------|------|----------|
| 完整时间 | `date "+%Y-%m-%d %H:%M:%S"` | 2026-01-07 14:30:00 |
| 仅日期 | `date "+%Y-%m-%d"` | 2026-01-07 |
| 仅时间 | `date "+%H:%M:%S"` | 14:30:00 |
| Unix 时间戳 | `date +%s` | 1704609000 |

### 耗时计算

```bash
# 开始时间
START_SECONDS=$(date +%s)

# ... 执行操作 ...

# 结束时间，计算耗时（分钟）
ELAPSED_MINUTES=$((($(date +%s) - START_SECONDS) / 60))
```

### 审计记录流程

```bash
# 步骤开始
STEP_START_TIME=$(date "+%Y-%m-%d %H:%M:%S")
STEP_START_SECONDS=$(date +%s)

# 更新 AUDIT.md: "| 步骤X | $STEP_START_TIME | | | 进行中 |"

# ... 执行操作 ...

# 步骤结束
STEP_END_TIME=$(date "+%Y-%m-%d %H:%M:%S")
STEP_END_SECONDS=$(date +%s)
ELAPSED_MINUTES=$((STEP_END_SECONDS - STEP_START_SECONDS))

# 更新 AUDIT.md: "| 步骤X | $STEP_START_TIME | $STEP_END_TIME | ${ELAPSED_MINUTES}m | ✓ |"
```


# 场景驱动测试指南

## 定位

**规范驱动 + 场景测试**：Delta Spec 定义功能场景 → 映射测试场景 → 实现代码后验证符合规范。

## 与 TDD 的区别

| 阶段 | TDD 纯粹派 | 规范驱动 + 场景测试 |
|------|-----------|---------------------|
| 驱动源 | 测试用例 | Delta Spec (Requirements + Scenarios) |
| 测试作用 | 驱动设计 | 验证符合规范 |

## 映射原则

| 原则 | 说明 |
|------|------|
| **必须覆盖** | 所有 Spec Scenarios 必须有对应测试 |
| **补充边界** | 根据需要补充边界、异常场景 |
| **从功能出发** | 描述功能行为，不涉及实现细节 |
| **可测试性** | 每个场景可独立验证 |

## 测试场景模板

```markdown
### 任务 X：[任务名称]

#### Spec Scenarios（必须覆盖）
| Spec Scenario | 测试场景 | 用例名 | 预期结果 |
|---------------|----------|--------|----------|
| [Spec 中的场景] | [对应测试场景] | test_xxx | [预期结果] |

#### 补充场景（边界/异常）
| 场景类型 | 测试场景 | 用例名 | 预期结果 |
|----------|----------|--------|----------|
| 边界/异常 | [补充场景] | test_xxx_edge | [预期结果] |
```

## 测试命令

### Python (pytest)
```bash
pytest                          # 所有测试
pytest tests/xxx_test.py -v     # 指定文件
pytest --cov=src                # 覆盖率
```

### JavaScript/TypeScript (npm/jest)
```bash
npm test                        # 所有测试
npm test -- xxx.test.js         # 指定文件
npm test -- --coverage          # 覆盖率
```

## 测试结果记录

### 单任务
```markdown
#### 任务 N：[任务名称]
**测试场景**: 场景1 → ✓, 场景2 → ✓
**测试文件**: tests/xxx_test.py
**测试结果**: ✓ 全绿（X/X）
**覆盖 Scenarios**: N/N（补充边界 M 个）
```

### 全量测试
```markdown
### 全量测试结果
**测试命令**: pytest / npm test
**测试结果**: ✓ 全绿

#### 统计
- Spec Scenarios 覆盖: N/N（100%）
- 新增测试场景: M 个（来自 Scenarios: N 个，补充边界: K 个）
- 新增测试用例: X 条
- 单元测试通过: X/X
- 代码覆盖率: XX%
```

## 测试失败处理

| 失败类型 | 处理方式 | 禁止行为 |
|----------|----------|----------|
| 代码 bug | 修复代码 | 禁止修改测试让测试通过 |
| 测试 bug | 修复测试 | 禁止删除测试用例 |
| Spec 不一致 | 更新 Spec 或代码 | 禁止忽略不一致 |

**禁止**：skip/xfail、删除测试、弱化断言。
